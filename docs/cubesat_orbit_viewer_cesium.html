<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CubeSat Orbit Viewer (CesiumJS)</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.109/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.109/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html, body, #cesiumContainer {
      width: 100%; height: 600px; margin: 0; padding: 0; overflow: hidden;
      font-family: sans-serif;
    }
    #ui {
      position: absolute; top: 10px; left: 10px; z-index: 1000;
      background: rgba(255, 255, 255, 0.8); padding: 10px; border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="ui">
    <label for="orbitSelect">Select Orbit:</label>
    <select id="orbitSelect">
      <option value="LEO">LEO (500 km)</option>
      <option value="SSO">SSO (700 km)</option>
      <option value="MOLNIYA">Molniya (Elliptical)</option>
    </select>
    <button onclick="drawOrbit()">ðŸš€ Show Orbit</button>
  </div>

  <script>
    // Initialize Cesium Viewer
    const viewer = new Cesium.Viewer('cesiumContainer', {
      timeline: false,
      animation: false,
      shouldAnimate: true
    });

    let satelliteEntity = null;
    let orbitPath = null;

    function drawOrbit() {
      const mode = document.getElementById("orbitSelect").value;

      // Clear old orbit
      if (satelliteEntity) viewer.entities.remove(satelliteEntity);
      if (orbitPath) viewer.entities.remove(orbitPath);

      // Set parameters based on orbit mode
      let altitude = 500;
      let inclination = 51.6;
      let ecc = 0.0;

      if (mode === "SSO") {
        altitude = 700;
        inclination = 98.6;
      } else if (mode === "MOLNIYA") {
        altitude = 26500;
        ecc = 0.7;
        inclination = 63.4;
      }

      const earthRadius = 6371; // in km
      const sma = earthRadius + altitude;

      const positions = [];
      const count = 360;

      for (let i = 0; i < count; i++) {
        const angle = Cesium.Math.toRadians(i);
        const r = sma * (1 - ecc * ecc) / (1 + ecc * Math.cos(angle)); // Elliptical
        const lat = Math.asin(Math.sin(angle) * Math.sin(Cesium.Math.toRadians(inclination)));
        const lon = angle;
        const cartesian = Cesium.Cartesian3.fromDegrees(
          Cesium.Math.toDegrees(lon),
          Cesium.Math.toDegrees(lat),
          r * 1000 // in meters
        );
        positions.push(cartesian);
      }

      // Draw orbit path
      orbitPath = viewer.entities.add({
        polyline: {
          positions: positions,
          width: 2,
          material: Cesium.Color.YELLOW
        }
      });

      // Satellite dot
      satelliteEntity = viewer.entities.add({
        position: positions[0],
        point: {
          pixelSize: 10,
          color: Cesium.Color.LIME
        },
        label: {
          text: "CubeSat",
          font: "14px sans-serif",
          pixelOffset: new Cesium.Cartesian2(10, -10)
        }
      });

      viewer.zoomTo(orbitPath);
    }

    // Auto-draw default orbit on load
    window.onload = () => {
    setTimeout(drawOrbit, 500); // Allow Cesium to initialize
    };

  </script>
</body>
</html>
